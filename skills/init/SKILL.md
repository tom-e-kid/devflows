---
name: init
description: Initialize .devflows directory with templates and build config
---

# init

Initialize the `.devflows/` directory in the current project with default templates and build configuration scaffold.

## What This Skill Does

1. Creates `.devflows/templates/` with default PR and issue templates
2. Optionally generates a `build/config.sh` scaffold for the project's platform
3. Makes it easy to customize templates right away

## Prerequisites

- Current directory is inside a git repository

## Procedure

### 0. Determine Git Root

**IMPORTANT: Always resolve git root first to ensure .devflows is found at the repository root (monorepo support).**

```bash
GIT_ROOT=$(git rev-parse --show-toplevel)
```

All `.devflows/` paths below MUST be prefixed with `$GIT_ROOT/`.

### 1. Run Init Script

**IMPORTANT: ALWAYS execute the init script below, even if `.devflows/` already exists.** The script is idempotent — it skips existing files and only creates what is missing. Do NOT skip this step based on directory existence checks.

Execute the init script to create directories and copy default templates:

```bash
"${CLAUDE_PLUGIN_ROOT}/skills/init/scripts/init.sh" "$GIT_ROOT" "${CLAUDE_PLUGIN_ROOT}"
```

Report the script output to the user.

### 2. Ask Platform

Ask the user to select their platform using AskUserQuestion:

| Option | Description |
|--------|-------------|
| `iOS` | iOS / Xcode project |
| `Web` | Web / Next.js / Node.js project |
| `Skip` | No build config needed |

### 3. Generate Build Config (if platform selected)

If the user selected a platform, write the following scaffold to `$GIT_ROOT/.devflows/build/config.sh`.

**For iOS:**

Copy default `.swift-format` to project root if not already present:

```bash
if [ ! -f "$GIT_ROOT/.swift-format" ]; then
    cp "${CLAUDE_PLUGIN_ROOT}/skills/ios-dev/.swift-format" "$GIT_ROOT/.swift-format"
fi
```

Generate config:

```bash
#!/bin/bash
# iOS Build Configuration
# Generated by /devflows:init

PLATFORM="ios"

# Project settings
WORKSPACE="<workspace>"
SCHEME="<scheme>"
DEPLOYMENT_TARGET="<version>"

# Latest OS build
LATEST_OS="<latest_version>"
LATEST_DEVICE="<device_name>"
LATEST_DEST="platform=iOS Simulator,name=<device>,OS=<version>"
BUILD_CMD_LATEST="xcodebuild -workspace \"$WORKSPACE\" -scheme \"$SCHEME\" -destination \"$LATEST_DEST\" clean build"

# Minimum OS build (for compatibility check)
MIN_OS="<minimum_version>"
MIN_DEVICE="<device_name>"
MIN_DEST="platform=iOS Simulator,name=<device>,OS=<version>"
BUILD_CMD_MINIMUM="xcodebuild -workspace \"$WORKSPACE\" -scheme \"$SCHEME\" -destination \"$MIN_DEST\" clean build"

# Warning filter (excludes noise)
WARNINGS_FILTER="grep -i 'warning:' | grep -v 'Metadata extraction skipped' | grep -v 'Could not get trait set' | sort -u"

# Format commands
FORMAT_CMD="git diff --name-only --diff-filter=AM | grep '\\.swift$' | xargs -I {} swift-format -i {}"
FORMAT_CHECK_CMD="git diff --name-only --diff-filter=AM | grep '\\.swift$' | xargs -I {} swift-format --strict -m {} 2>&1"
```

**For Web:**

```bash
#!/bin/bash
# Web Build Configuration
# Generated by /devflows:init

PLATFORM="web"

# Package manager
PACKAGE_MANAGER="bun"  # bun | npm | yarn | pnpm

# Project root (relative to repo root)
PROJECT_ROOT="."  # or "apps/web" for monorepos

# Build commands
BUILD_CMD="bun run build"
DEV_CMD="bun run dev"

# Quality commands
LINT_CMD="bun run lint"
FORMAT_CMD="bun run format"
FORMAT_CHECK_CMD="bun run format:check"
TEST_CMD="bun run test"
TYPECHECK_CMD="bun run typecheck"  # if available

# Warning/error extraction
WARNINGS_FILTER="grep -E '(warning|Warning|WARN)' | sort -u"
ERRORS_FILTER="grep -E '(error|Error|ERR)' | sort -u"
```

If the user selected **Skip**, skip this step entirely.

### 4. Report

Display the following summary to the user:

```
## devflows initialized

.devflows/
├── templates/
│   ├── pr.md          ← customize PR format
│   └── issue.md       ← customize issue format
├── build/
│   └── config.sh      ← [platform] build config (edit placeholders)
└── sessions/

.swift-format              ← (iOS only) swift-format config (4-space indent, 120 line length)

Edit templates in .devflows/templates/ to customize PR and issue formats.
Build config placeholders (<...>) should be filled in — or run /devflows:ios-dev or /devflows:web-dev to auto-detect.

### Next Steps

| Command | Description |
|---------|-------------|
| `/devflows:issue` | Create a GitHub Issue to plan your work |
| `/devflows:start` | Start a new feature session (branch + session directory) |
| `/devflows:issues` | List and manage existing GitHub Issues |
```

If build config was skipped, omit the `config.sh` line, the `.swift-format` line, and the build config note from the summary.

## Notes

- Templates are not overwritten if they already exist — safe to re-run
- Build config is a scaffold with placeholders; use `/devflows:ios-dev` or `/devflows:web-dev` for auto-detection
- The `.devflows/build/` and `.devflows/sessions/` directories should be in `.gitignore`
- The `.devflows/templates/` directory should be committed to the repo
