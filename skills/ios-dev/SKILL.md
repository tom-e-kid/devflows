---
name: ios-dev
description: iOS/Xcode build configuration and verification. Creates .devflows/build/config.sh for iOS projects.
---

# ios-dev

Configure and verify Xcode build settings for iOS projects.

**Platform**: iOS / Xcode only

## When to Use

- Called by `/devflows:feature-setup` when iOS project detected (`*.xcworkspace` or `*.xcodeproj`)
- Called manually to reconfigure build settings
- After Xcode or simulator updates

## Git Root Resolution

**IMPORTANT: Always resolve git root first to ensure .devflows is created at the repository root (monorepo support).**

```bash
GIT_ROOT=$(git rev-parse --show-toplevel)
```

All `.devflows/` paths below should be prefixed with `$GIT_ROOT/`.

## Behavior

1. Check if `$GIT_ROOT/.devflows/build/config.sh` exists
2. If exists:
   - Read and display current configuration
   - Ask user if they want to reconfigure
3. If not exists (or reconfigure requested):
   - Run environment investigation using helper script
   - Present findings to user for confirmation
   - Generate `$GIT_ROOT/.devflows/build/config.sh`

## Environment Investigation

**IMPORTANT: Use the helper script instead of running individual commands.**

```bash
# Get skill directory (via symlink in .claude/skills/)
SKILL_DIR=".claude/skills/ios-dev"

# Gather all environment info in one command
"$SKILL_DIR/scripts/ios-env-info.sh"
```

This script outputs:
- Workspace/project path
- Available schemes
- Deployment target
- Installed iOS runtimes
- Available simulators

Based on the output, ask user to confirm:
- Which scheme to use
- Latest iOS version and device
- Minimum iOS version and device

## Configuration File Format

Generate `$GIT_ROOT/.devflows/build/config.sh`:

```bash
#!/bin/bash
# iOS Build Configuration
# Generated by /devflows:ios-dev on <date>

PLATFORM="ios"

# Project settings
WORKSPACE="<workspace>"
SCHEME="<scheme>"
DEPLOYMENT_TARGET="<version>"

# Latest OS build
LATEST_OS="<latest_version>"
LATEST_DEVICE="<device_name>"
LATEST_DEST="platform=iOS Simulator,name=<device>,OS=<version>"
BUILD_CMD_LATEST="xcodebuild -workspace \"$WORKSPACE\" -scheme \"$SCHEME\" -destination \"$LATEST_DEST\" clean build"

# Minimum OS build (for compatibility check)
MIN_OS="<minimum_version>"
MIN_DEVICE="<device_name>"
MIN_DEST="platform=iOS Simulator,name=<device>,OS=<version>"
BUILD_CMD_MINIMUM="xcodebuild -workspace \"$WORKSPACE\" -scheme \"$SCHEME\" -destination \"$MIN_DEST\" clean build"

# Warning filter (excludes noise)
WARNINGS_FILTER="grep -i 'warning:' | grep -v 'Metadata extraction skipped' | grep -v 'Could not get trait set' | sort -u"
```

## Helper Scripts

All scripts are located in `.claude/skills/ios-dev/scripts/`.

### ios-env-info.sh

Gathers environment information for configuration:

```bash
.claude/skills/ios-dev/scripts/ios-env-info.sh [workspace]
```

### ios-build.sh

Runs build and extracts warnings:

```bash
.claude/skills/ios-dev/scripts/ios-build.sh [latest|minimum] [--save-baseline <path>]
```

### ios-warnings-diff.sh

Compares warnings against baseline:

```bash
.claude/skills/ios-dev/scripts/ios-warnings-diff.sh <baseline_file> [current_warnings_file]
```

## Warning Baseline

Excluded warnings (noise):
- `Metadata extraction skipped` - App Intents framework noise (harmless)
- `Could not get trait set for device` - iOS simulator version mismatch (harmless)

## Notes

- `$GIT_ROOT/.devflows/build/config.sh` is local only (should be in .gitignore)
- Reconfigure when Xcode or simulators are updated
- Both latest and minimum OS builds should use devices that actually exist in the runtime
